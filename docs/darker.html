<html>
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"  integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>
        .table-nonfluid {
            width: auto !important;
        }
    </style>
</head>
<body>
<div id="app">
  <div class="accordion" id="accordion">
    <split
        v-for="split in splits"
        v-bind:accordion-id="'accordion'"
        v-bind:runners="runners"
        v-bind:split="split"
        v-bind:key="split.id">
    </split>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<script>
var splitTemplate = 
`
<div class="card">
  <div class="card-header" v-bind:id="headingId">
    <h2 class="mb-0">
      <button
          class="btn btn-link"
          type="button"
          data-toggle="collapse"
          v-bind:data-target="'#' + split.id"
          aria-expanded="true"
          v-bind:aria-controls="split.id">
        {{split.name}}
      </button>
    </h2>
  </div>
  <div
      v-bind:id="split.id"
      class="collapse"
      v-bind:aria-labelledby="headingId"
      v-bind:data-parent="'#' + accordionId">
    <div class="card-body">
      <table class="table table-bordered table-striped table-sm table-nonfluid">
        <thead>
          <tr>
            <th>Split</th>
            <th v-for="runner in runners">{{runner}}</th>
          </tr>
        </thead>
        <subsplit
            v-for="subsplit in split.subsplits"
            v-bind:runners="runners"
            v-bind:splitid="split.id"
            v-bind:subsplit="subsplit"
            v-bind:key="subsplit.to">
        </subsplit>
      </table>
    </div>
  </div>
</div>`;

var subsplitTemplate =
`<tr>
  <td>
  From: {{subsplit.from}}<br>
  To: {{subsplit.to}}
  </td>
  <clip
      v-for="clip in subsplit.clips"
      v-bind:clip="clip"
      v-bind:key="clip.id"
      v-bind:color="computeColor(clip.time)">
  </clip>
</tr>`;

var clipTemplate = 
`<td>
  <button
      v-bind:class="'btn ' + color + ' collapsed'"
      type="button"
      data-toggle="collapse"
      v-bind:data-target="'#' + clip.id"
      aria-expanded="false"
      v-bind:aria-controls="clip.id"
      v-bind:disabled="clip.time === null">
    {{clip.time ?? "n/a"}}
  </button>
  <div v-if="clip.time" v-bind:id="clip.id" class="collapse" v-bind:aria-labelledby="clip.id"></div>
</td>`;

Vue.component('clip', {
  props: ['clip', 'color'],
  template: clipTemplate
});

Vue.component('subsplit', {
  props: ['runners', 'splitid', 'subsplit'],
  template: subsplitTemplate,
  computed: {
    times: function() {
        return this.subsplit.clips.map(clip => clip.time).filter(val => val !== null);
    },
    fastestTime: function() {
        return Math.min.apply(null, this.times);
    },
    slowestTime: function() {
        return Math.max.apply(null, this.times);
    }
  },
  methods: {
    computeColor: function(time) {
        if (time == null) {
            return "btn-secondary";
        }
        if (time == this.fastestTime){
            return "btn-success";
        }
        if (time == this.slowestTime){
            return "btn-danger";
        }
        return "btn-warning";
    }
  }
});

Vue.component('split', {
  props: ['accordionId', 'runners', 'split'],
  template: splitTemplate,
  computed: {
      headingId: function() {
          return this.split.id + "-heading";
      }
  }
});

var data = {
	'runners': [
        'Dangers',
        'Neo',
        'Vallu'
    ],
	'splits': [{
        'id': 'wooded2',
		'name': 'Wooded 2',
        'subsplits': [{
            'id': '0',
            'from': 'Wooded Moon a',
            'to': 'Wooded Moon b',
            'clips': [{
                'id': 'wooded2-0-0',
				'time': 13.233,
				'url': 'https://www.youtube.com/embed/DzJQplLyiZQ?start=7630&end=7647'
			},
            {
                'id': 'wooded2-0-1',
				'time': 14.433,
				'url': 'https://www.youtube.com/embed/nYINBviIDHc?start=7736&end=7754'
			},
            {
                'id': 'wooded2-0-2',
				'time': 14.333,
				'url': 'https://player.twitch.tv/?video=552750629&autoplay=false&time=1h2m3s'
			}]
		}]
	},{
        'id': 'sand2',
		'name': 'Sand 2',
        'subsplits': [{
            'id': '0',
			'from': 'Secret Path to Tostarena!',
            'to': 'Top of a Dune',
            'clips': [
            {
                'id': 'sand2-0-0',
				'time': 12.333,
				'url': 'https://www.youtube.com/embed/DzJQplLyiZQ?start=7598&end=7614'
			},
            {
                'id': 'sand2-0-1',
				'time': 13.933,
				'url': 'https://www.youtube.com/embed/nYINBviIDHc?start=7702&end=7720'
			},
            {
                'id': 'sand2-0-2',
				'time': 14.333,
				'url': 'https://player.twitch.tv/?video=552750629&autoplay=false&time=1h2m3s'
			}]
		},{
            'id': '0',
			'from': 'Top of a Dune',
            'to': 'Caught Hopping in the Desert!',
            'clips': [
            {
                'id': 'sand2-1-0',
				'time': 19.967,
				'url': 'https://www.youtube.com/embed/DzJQplLyiZQ?start=7610&end=7634'
			},
            {
                'id': 'sand2-1-1',
				'time': 20.167,
				'url': 'https://www.youtube.com/embed/nYINBviIDHc?start=7716&end=7740'
			},
            {
                'id': 'sand2-1-2',
				'time': 14.333,
				'url': 'https://player.twitch.tv/?video=552750629&autoplay=false&time=1h2m3s'
			}]
		},{
            'id': '0',
			'from': 'Desert Gardening: Plaza Seed',
            'to': 'Found in the Sand! Good Dog!',
            'clips': [
            {
                'id': 'sand2-2-0',
				'time': 11.067,
				'url': 'https://www.youtube.com/embed/DzJQplLyiZQ?start=7690&end=7705'
			},
            {
                'id': 'sand2-2-1',
				'time': 10.067,
				'url': 'https://www.youtube.com/embed/nYINBviIDHc?start=7796&end=7810'
			},
            {
                'id': 'sand2-2-2',
				'time': null,
				'url': null
			}]
		}]
	},{
        'id': 'metro2',
		'name': 'Metro 2',
        'subsplits': [{
            'id': '0',
            'from': 'Metro Moon a',
            'to': 'Metro Moon b',
            'clips': [{
                'id': 'metro2-0-0',
				'time': 13.233,
				'url': 'https://www.youtube.com/embed/DzJQplLyiZQ?start=7630&end=7647'
			},
            {
                'id': 'metro2-0-1',
				'time': 14.433,
				'url': 'https://www.youtube.com/embed/nYINBviIDHc?start=7736&end=7754'
			},
            {
                'id': 'metro2-0-2',
				'time': 14.333,
				'url': 'https://player.twitch.tv/?video=552750629&autoplay=false&time=1h2m3s'
			}]
		}]
	}]
};

var app = new Vue({
  el: '#app',
  data: data
})

var urls = {};
data.splits.forEach(function(split) {
    split.subsplits.forEach(function(subsplit) {
        subsplit.clips.forEach(function(clip) {
            if (clip.url)
            {
                urls[clip.id] = clip.url;
            }
        })
    })
});

$('#app').on('show.bs.collapse', function (e) {
    console.log(e.target.id);
    if (e.target.id in urls)
    {
        $(e.target).html('<iframe width="480" height="360" src="' + urls[e.target.id] + '"></iframe>');
    }
});
$('#app').on('hidden.bs.collapse', function (e) {
    if (e.target.id in urls)
    {
        $(e.target).html('');
    }
});

$('#sand2').collapse('show')

</script>
</body>
<footer class="page-footer font-small blue pt-4">
  <div class="footer-copyright text-center py-3">Â© 2020 Copyright: schultzaur</div>
</footer>
</html>